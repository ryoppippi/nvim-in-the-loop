# AI-Optimised Vim Keybindings

[![DeepWiki](https://img.shields.io/badge/DeepWiki-ryoppippi%2Fnvim--in--the--loop-blue.svg?logo=data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACwAAAAyCAYAAAAnWDnqAAAAAXNSR0IArs4c6QAAA05JREFUaEPtmUtyEzEQhtWTQyQLHNak2AB7ZnyXZMEjXMGeK/AIi+QuHrMnbChYY7MIh8g01fJoopFb0uhhEqqcbWTp06/uv1saEDv4O3n3dV60RfP947Mm9/SQc0ICFQgzfc4CYZoTPAswgSJCCUJUnAAoRHOAUOcATwbmVLWdGoH//PB8mnKqScAhsD0kYP3j/Yt5LPQe2KvcXmGvRHcDnpxfL2zOYJ1mFwrryWTz0advv1Ut4CJgf5uhDuDj5eUcAUoahrdY/56ebRWeraTjMt/00Sh3UDtjgHtQNHwcRGOC98BJEAEymycmYcWwOprTgcB6VZ5JK5TAJ+fXGLBm3FDAmn6oPPjR4rKCAoJCal2eAiQp2x0vxTPB3ALO2CRkwmDy5WohzBDwSEFKRwPbknEggCPB/imwrycgxX2NzoMCHhPkDwqYMr9tRcP5qNrMZHkVnOjRMWwLCcr8ohBVb1OMjxLwGCvjTikrsBOiA6fNyCrm8V1rP93iVPpwaE+gO0SsWmPiXB+jikdf6SizrT5qKasx5j8ABbHpFTx+vFXp9EnYQmLx02h1QTTrl6eDqxLnGjporxl3NL3agEvXdT0WmEost648sQOYAeJS9Q7bfUVoMGnjo4AZdUMQku50McDcMWcBPvr0SzbTAFDfvJqwLzgxwATnCgnp4wDl6Aa+Ax283gghmj+vj7feE2KBBRMW3FzOpLOADl0Isb5587h/U4gGvkt5v60Z1VLG8BhYjbzRwyQZemwAd6cCR5/XFWLYZRIMpX39AR0tjaGGiGzLVyhse5C9RKC6ai42ppWPKiBagOvaYk8lO7DajerabOZP46Lby5wKjw1HCRx7p9sVMOWGzb/vA1hwiWc6jm3MvQDTogQkiqIhJV0nBQBTU+3okKCFDy9WwferkHjtxib7t3xIUQtHxnIwtx4mpg26/HfwVNVDb4oI9RHmx5WGelRVlrtiw43zboCLaxv46AZeB3IlTkwouebTr1y2NjSpHz68WNFjHvupy3q8TFn3Hos2IAk4Ju5dCo8B3wP7VPr/FGaKiG+T+v+TQqIrOqMTL1VdWV1DdmcbO8KXBz6esmYWYKPwDL5b5FA1a0hwapHiom0r/cKaoqr+27/XcrS5UwSMbQAAAABJRU5ErkJggg==)](https://deepwiki.com/ryoppippi/nvim-in-the-loop)
<!-- DeepWiki badge generated by https://deepwiki.ryoppippi.com/ -->

Human-in-the-loop playground for the talk â€œAI-Optimised Vim Keybindings: HCI-Driven HITL Interfacesâ€.

## Features

- Capture Neovim keystrokes across modes and persist them as JSONL.
- `:AiKeymapStart`, `:AiKeymapStop`, `:AiKeymapFlush`, `:AiKeymapStatus` commands for runtime control.
- `:AiKeymapVisualize` streams a Bun CLI that crunches the log, inspects your dotfiles (auto-detected at `~/.config/nvim`), and optionally augments the report with GPTâ€‘5 proposals.
- `:AiKeymapSuggest` uses Lua heuristics to flag repeated movement keys (e.g. `jjj`) and surfaces alternative mappings directly inside Neovim (`y` copies the snippet).
- Optional `:AiKeymapOpenLog` helper to inspect the raw dataset before sending it to an LLM.

## Setup

1. Ensure [Bun](https://bun.sh) is installed (`bun --version`).
2. Add this repo to your `runtimepath`, or package it with your Neovim config.
3. (Optional) Configure the plugin during setup:

```lua
require("ai_keymap").setup({
  log_path = vim.fn.stdpath("data") .. "/ai_keymap/keystrokes.jsonl",
  visualize_cmd = { "bun", "run", "src/cli.ts" },
  visualize_args = { "--dotfiles", vim.fn.expand("~/.config/nvim") },
  suggest_options = { min_repeat = 3, min_occurrence = 2 },
  start_immediately = true,
})
```

4. Export an OpenAI-compatible API key before requesting AI suggestions:

```bash
export OPENAI_API_KEY=sk-your-key
```

## Demo Flow

1. Launch Neovim and run `:AiKeymapStart`.
2. Perform editing tasks representative of your audience persona.
3. Trigger `:AiKeymapVisualize` to open the floating dashboard (add `--skip-ai` to disable GPT calls).
4. Run `:AiKeymapSuggest` to inspect repeated movements detected heuristically; press `y` to yank the suggested mapping snippet.
5. Stop capture with `:AiKeymapStop` when done.

## CLI Usage

The Bun CLI is shared between the floating window and your terminal:

```bash
bun run src/cli.ts \
  --log ~/.local/share/nvim/ai_keymap/keystrokes.jsonl \
  --dotfiles ~/.config/nvim \
  --top 8

# suggestions only
bun run src/cli.ts --suggestions-only
```

- Scans your log for frequent keystroke sequences.
- Reads `vim.keymap.set` / `noremap` style mappings from the dotfiles you provide.
- Calls GPTâ€‘5 (via the Vercel AI SDK) to propose non-conflicting shortcuts. Use `--skip-ai` to disable the model.
- Pass `--format json` for machine-readable output.
- Use `--suggestions-only` to print only the AI suggestion block while hiding the rest of the report.
- The Neovim picker (`:AiKeymapSuggest`) now relies on Lua heuristics. Analytics-only users can run the CLI separately with `--skip-ai`.

> ðŸ’¡ Adjust thresholds via `:AiKeymapSuggest --min-repeat 4`. If you need GPT-powered suggestions, run the CLI (`bun run src/cli.ts`) without `--skip-ai`.

## Build & Distribute

```bash
# produce dist/cli.js with a Node shebang
bun run build

# (after packaging/publishing) invoke via bunx
bunx ai-keymap --log ~/.local/share/nvim/ai_keymap/keystrokes.jsonl --skip-ai
```

`package.json` exposes the CLI as `ai-keymap`, so once the package is published you can call it directly through `bunx`, or run it locally from `dist/cli.js`.

## Logs

The capture log contains JSONL objects like:

```json
{
  "seq": 1,
  "raw": "j",
  "key": "j",
  "mode": "n",
  "timestamp": 1234567890,
  "filetype": "lua",
  "file": "/path/to/file.lua"
}
```

Extend `src/cli.ts` or `scripts/visualize.ts` with custom heuristics, or swap in a different model endpoint as needed for the live demo.
